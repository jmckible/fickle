%p= link_to 'Back', root_path

%h1= @poll.name
%p= link_to 'Edit Choices', [:edit, @poll]
%p= link_to 'Edit Participants', [@poll, :caucuses]

%h2 Vote


.ballot{ data: { controller: 'ballot' } }
  = form [@poll, Ballot.new] do |f|
    %h3 Choices
    %ul.choices{ data: { target: 'ballot.choices' } }
      - @poll.choices.live.by_random.each do |c|
        = f.fields_for 'rankings[]', Ranking.new(choice: c) do |rf|
          %li{ data: { ballot: { choice_id: c.id }}}
            = rf.hidden_field :choice_id
            = c.name

  = form [@poll, Ballot.new] do |f|
    %h3 Ranking
    %ol.rankings{ data: { target: 'ballot.rankings' } }
    = f.submit 'Submit'


%h2 Past Ballots

- Current.user.ballots.for(@poll).newest_first.each do |b|
  = local_time b.created_at
  %ol
    - b.rankings.includes(:choice).each do |r|
      %li= r.choice.name
